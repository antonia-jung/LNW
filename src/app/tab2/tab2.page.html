<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button aria-label="Info" (click)="goImpressum()" fill="clear">
        <ion-icon name="information-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ segmentLabel }}</ion-title>
  </ion-toolbar>

  <!-- Segment-Menü -->
  <ion-toolbar class="toolbar-normal">
    <ion-segment [scrollable]="true" [(ngModel)]="selectedSegment">
      <ion-segment-button
        value="Komplett"
        (click)="setSegmentLabel('Komplett')"
      >
        <ion-icon
          src="../../../assets/Programm.svg"
          [style.color]="selectedSegment === 'Komplett' ? '#ffffff' : 'var(--lnw-lila)'"
        >
        </ion-icon>
      </ion-segment-button>

      <ion-segment-button value="Themen" (click)="setSegmentLabel('Themen')">
        <ion-icon
          src="../../../assets/Themen.svg"
          [style.color]="selectedSegment === 'Themen' ? '#ffffff' : 'var(--lnw-lila)'"
        >
        </ion-icon>
      </ion-segment-button>

      <ion-segment-button value="Formate" (click)="setSegmentLabel('Formate')">
        <ion-icon
          src="../../../assets/Formate.svg"
          [style.color]="selectedSegment === 'Formate' ? '#ffffff' : 'var(--lnw-lila)'"
        >
        </ion-icon>
      </ion-segment-button>

      <ion-segment-button value="Orte" (click)="setSegmentLabel('Orte')">
        <ion-icon
          src="../../../assets/orte.svg"
          [style.color]="selectedSegment === 'Orte' ? '#ffffff' : 'var(--lnw-lila)'"
        >
        </ion-icon>
      </ion-segment-button>

      <ion-segment-button
        value="Einrichtungen"
        (click)="setSegmentLabel('Einrichtungen')"
      >
        <ion-icon
          src="../../../assets/Einrichtungen.svg"
          [style.color]="selectedSegment === 'Einrichtungen' ? '#ffffff' : 'var(--lnw-lila)'"
        >
        </ion-icon>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Auswahllisten (Themen / Formate / Orte / Einrichtungen) -->
  <div *ngIf="contentSelector !== 'Komplett' && selectedTheme === ''">
    <ion-list *ngIf="contentSelector === 'Themen'">
      <ion-item *ngFor="let theme of uniqueThemes" (click)="selectTheme(theme)">
        {{ theme }}
        <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
      </ion-item>
    </ion-list>

    <ion-list *ngIf="contentSelector === 'Formate'">
      <ion-item
        *ngFor="let format of uniqueFormats"
        (click)="selectTheme(format)"
      >
        {{ format }}
        <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
      </ion-item>
    </ion-list>

    <ion-list *ngIf="contentSelector === 'Orte'">
      <ion-item *ngFor="let ort of uniqueOrte" (click)="selectTheme(ort)">
        {{ ort }}
        <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
      </ion-item>
    </ion-list>

    <ion-list
      *ngIf="contentSelector === 'Einrichtungen'"
      class="einrichtungen-list"
    >
      <ion-item
        *ngFor="let inst of uniqueEinrichtungen"
        (click)="selectTheme(inst)"
      >
        {{ inst }}
        <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
      </ion-item>
    </ion-list>
  </div>

  <!-- Einträge -->
  <ng-container *ngIf="contentSelector === 'Komplett' || selectedTheme !== ''">
    <ng-container *ngFor="let group of filteredGroups">
      <ion-item lines="none" class="group-header">
        <ion-label><h2>{{ group.time.replace(':', '.') }} Uhr</h2></ion-label>
      </ion-item>

      <ion-card *ngFor="let item of group.items; trackBy: trackById">
        <ion-card-header>
          <ion-card-title>{{ item.titel }}</ion-card-title>
          <ion-card-subtitle>
            <span class="time">
              <ion-icon name="time-outline"></ion-icon>
              {{ item.beginn }} – {{ item.ende }}
            </span>
          </ion-card-subtitle>

          <ion-icon
            *ngIf="item.favorit !== undefined"
            class="fav-heart"
            [name]="item.favorit ? 'heart' : 'outline-heart'"
            [style.color]="item.favorit ? 'var(--ion-color-danger)' : 'gray'"
            (click)="toggleFavorit(item); $event.stopPropagation()"
          ></ion-icon>
        </ion-card-header>

        <ion-card-content (click)="openDetail(item)">
          <div class="meta-icons">
            <div class="left-icons">
              <ion-icon
                *ngIf="item.kinder"
                src="assets/lndw_icon_kids.svg"
                title="Kinder geeignet"
              ></ion-icon>
              <span
                class="divider"
                *ngIf="item.kinder && (item.barrierefrei || item.english)"
              ></span>

              <ion-icon
                *ngIf="item.barrierefrei"
                src="assets/lndw_icon_barrierenfrei.svg"
                title="Barrierefrei"
              ></ion-icon>
              <span
                class="divider"
                *ngIf="item.barrierefrei && item.english"
              ></span>

              <ion-icon
                *ngIf="item.english"
                src="assets/lndw_icon_englisch.svg"
                title="English available"
              ></ion-icon>
            </div>
            <div class="format-text">{{ item.format }}</div>
          </div>
        </ion-card-content>
      </ion-card>
    </ng-container>
  </ng-container>

  <ion-infinite-scroll (ionInfinite)="ladeMehrDaten($event)">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Lade mehr Einträge..."
    ></ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <ng-container *ngIf="!eintraege.length">
    <ion-item lines="none"
      ><ion-label
        >Wird geladen oder keine Einträge gefunden…</ion-label
      ></ion-item
    >
  </ng-container>

  <!-- FAB Filter -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end" class="fab-br">
    <ion-fab-button class="fab-orange" aria-label="Filter Menü">
      <ion-icon name="filter-outline"></ion-icon>
    </ion-fab-button>

    <ion-fab-list side="top">
      <ion-fab-button
        class="fab-action"
        [class.active]="isActive('kinder')"
        (click)="toggleFilter('kinder')"
        aria-label="Kinder"
      >
        <ion-icon src="assets/lndw_icon_kids.svg"></ion-icon>
      </ion-fab-button>

      <ion-fab-button
        class="fab-action"
        [class.active]="isActive('barrierefrei')"
        (click)="toggleFilter('barrierefrei')"
        aria-label="Barrierefrei"
      >
        <ion-icon src="assets/lndw_icon_barrierenfrei.svg"></ion-icon>
      </ion-fab-button>

      <ion-fab-button
        class="fab-action"
        [class.active]="isActive('english')"
        (click)="toggleFilter('english')"
        aria-label="Englisch"
      >
        <ion-icon src="assets/lndw_icon_englisch.svg"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>
