<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>Details</ion-title>

    <!-- Herz rechts im Header (Favorit) -->
    <ion-buttons slot="end">
      <ion-button
        fill="clear"
        [disabled]="!entry()"
        (click)="toggleFav()"
        [attr.aria-label]="isFav() ? 'aus „Meine Nacht“ entfernen' : 'in „Meine Nacht“ speichern'"
      >
        <ion-icon [name]="isFav() ? 'heart' : 'heart-outline'"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ng-container *ngIf="!isLoading(); else loading">
    <ng-container *ngIf="entry(); else notfound">
      <ion-list inset="true">
        <!-- Titel + Beschreibung -->
        <ion-item>
          <ion-label>
            <h2>{{ entry()!.titel }}</h2>
            <div [innerHTML]="entry()?.beschreibung"></div>
          </ion-label>
        </ion-item>

        <!-- Zeit (robust formatiert) -->
        <ion-item *ngIf="entry()?.beginn || entry()?.ende">
          <ion-icon
            slot="start"
            name="time-outline"
            aria-hidden="true"
          ></ion-icon>
          <ion-label>
            {{ formatTime(entry()!.beginn) }} – {{ formatTime(entry()!.ende) }}
          </ion-label>
        </ion-item>

        <!-- Ort -->
        <ion-item *ngIf="entry()?.ort || entry()?.adresse">
          <ion-icon
            slot="start"
            name="location-outline"
            aria-hidden="true"
          ></ion-icon>
          <ion-label>
            {{ entry()!.ort }}<br />
            {{ entry()!.adresse }}
          </ion-label>
        </ion-item>

        <!-- Einrichtung -->
        <ion-item *ngIf="entry()?.einrichtung">
          <ion-icon
            slot="start"
            name="business-outline"
            aria-hidden="true"
          ></ion-icon>
          <ion-label> {{ entry()!.einrichtung }} </ion-label>
        </ion-item>

        <!-- Format (mit HTML möglich) -->
        <ion-item *ngIf="entry()?.format">
          <ion-icon
            slot="start"
            name="easel-outline"
            aria-hidden="true"
          ></ion-icon>
          <ion-label>
            <div [innerHTML]="entry()?.format"></div>
          </ion-label>
        </ion-item>

        <!-- Themen -->
        <ion-item *ngIf="entry()?.themen">
          <ion-icon
            slot="start"
            name="pricetag-outline"
            aria-hidden="true"
          ></ion-icon>
          <ion-label> {{ entry()!.themen }} </ion-label>
        </ion-item>

        <!-- Großer Favoriten-Button -->
        <ion-item class="fav-item" lines="none">
          <ion-button class="fav-button" (click)="toggleFav()">
            <ion-icon
              slot="start"
              [name]="isFav() ? 'heart' : 'heart-outline'"
            ></ion-icon>
            {{ isFav() ? 'aus "Meine Nacht" entfernen' : 'in "Meine Nacht"
            speichern' }}
          </ion-button>
        </ion-item>
      </ion-list>
    </ng-container>
  </ng-container>

  <ng-template #loading>
    <ion-item lines="none"><ion-label>Laden…</ion-label></ion-item>
  </ng-template>

  <ng-template #notfound>
    <ion-item lines="none"
      ><ion-label>Eintrag nicht gefunden.</ion-label></ion-item
    >
  </ng-template>
</ion-content>
